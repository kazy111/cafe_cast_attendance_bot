# 出勤管理BOT

[エミュリボン](https://twitter.com/AimyouRibbon) キャストの出勤を勝手に管理するために作成したLINE用のBOTです。他の店でも使おうと思えば使える、筈…。

公式では出勤予定が上げられず各キャストが個別に予定を上げるような場合に、LINEをインターフェイスとしてDBを運用することを想定しています。

## 必要なもの
- HTTPSとPHP5.5以上が使えるWebサーバ
- Composer
- PostgreSQL 9.3くらい (9.3.14で動作確認)
- LINEのBOT用アカウント

## セットアップ
多分誰も使わないと思うので親切なセットアップはありません。
まず [LINE Business Center](https://business.line.me/ja/services/bot) にログインしてMessegingAPIが使えるアカウントを準備し、Channel SecretとChannel Access Tokenをメモし、Webhook URLに公開予定のURLを設定します。
PostgreSQLにddlフォルダ内にある定義をぶちこんで、`src/settings.php` を編集してLINE設定、DB設定、タイトル設定を行います。
あとは適当な位置に置いて、`composer install` で依存ライブラリを入れ、公開したら完了。たぶん。

## 操作方法

トーク or グループトークで特定のコマンドを発言して操作します。
各コマンドを先頭に書き、スペース区切りで引数を与えます。引数の数によって挙動がします。

- 「出勤一覧」で当月の出勤表(URL)を表示
- 「出勤」で当日の出勤者
- 「出勤 [キャスト名]」で対象の今後の出勤日10件
- 「出勤 [キャスト名] [出勤日1] [出勤日2] ...」で出勤登録
- 「出勤 [キャスト名] [出勤日1]× ...」で出勤削除
- 「キャスト [キャスト名]」で新規キャスト登録
- 「キャスト [キャスト名] [キャスト別名1] [キャスト別名2] ...」でキャスト別名登録

なおキャスト名は、末尾にちゃん、さんを付けても認識します。 

例1: 出勤 ゆう 1 2 3 4  
→ キャスト名 ゆう の出勤日として、当月の1日、2日、3日、4日を設定

例2: 出勤 ゆう 11/1 12/2 1/3 8/4  
→ 現在が2016年11月の場合、キャスト名 ゆう の出勤日として、2016/11/11、2016/12/2、2017/1/3、2016/8/4を設定

例3: 出勤 すぅちゃん  
→ キャスト名 すぅ、もしくは すうちゃん の出勤日を最大10件表示
